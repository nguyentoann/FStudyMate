# Notification System Documentation

## Overview

The notification system provides a comprehensive solution for sending and receiving notifications between users in the FStudyMate application. This system supports:

- Individual notifications between users
- Group notifications to classes or multiple users
- Markdown formatting for rich content
- File attachments (images and documents)
- Read status tracking
- Notification unsending

## Architecture

### Backend Components

- **Model**: `Notification` and `NotificationRecipient` entities
- **Repository**: JPA repositories for database operations
- **Service**: `NotificationService` for business logic
- **Controller**: `NotificationController` for REST API endpoints
- **DTO**: Data transfer objects for API requests and responses

### Frontend Components

- **NotificationBell**: Component for displaying notifications in the navbar
- **NotificationModal**: Component for displaying notification details
- **NotificationList**: Component for displaying lists of notifications
- **CreateNotification**: Form for creating new notifications
- **NotificationDebugger**: Tool for debugging notification functionality
- **NotificationService**: Service for API communication

## Features

### 1. Sending Notifications

Notifications can be sent to various types of recipients:

- **Individual**: Send to specific users
- **Class**: Send to all students in one or more classes
- **All Students**: Send to all students
- **All Outsource Students**: Send to all outsource students
- **All Lecturers**: Send to all lecturers
- **All**: Send to everyone

### 2. Markdown Support

Notification content supports Markdown formatting, allowing:

- **Bold** and *italic* text
- Lists and tables
- Links and images
- Code blocks
- Headers

### 3. File Attachments

Notifications can include file attachments, with different handling based on file type:

- **Images**: Displayed directly in the notification
- **Documents**: Available for download
- **Other files**: Available for download

### 4. Notification Management

Recipients can:
- View notifications
- Mark notifications as read
- Delete notifications

Senders can:
- View sent notifications
- Unsend notifications (will hide them from recipients)
- Delete notifications

## API Endpoints

### Notification Creation

- `POST /api/notifications`: Create a new notification
- `POST /api/notifications/with-attachment`: Create a notification with attachment

### Notification Retrieval

- `GET /api/notifications/user/{userId}`: Get all notifications for a user
- `GET /api/notifications/user/{userId}/unread`: Get unread notifications for a user
- `GET /api/notifications/user/{userId}/unread/count`: Count unread notifications for a user
- `GET /api/notifications/sent-by/{userId}`: Get notifications sent by a user
- `GET /api/notifications/{notificationId}`: Get a specific notification

### Notification Management

- `PUT /api/notifications/{notificationId}/read/{userId}`: Mark a notification as read
- `PUT /api/notifications/user/{userId}/read-all`: Mark all notifications as read
- `PUT /api/notifications/{notificationId}/unsend/{senderId}`: Unsend a notification
- `DELETE /api/notifications/{notificationId}/user/{userId}`: Delete a notification

## Database Schema

### Notifications Table

| Column | Type | Description |
|--------|------|-------------|
| id | BIGINT | Primary key |
| sender_id | BIGINT | Foreign key to user |
| title | VARCHAR(255) | Notification title |
| content | TEXT | Markdown content |
| created_at | TIMESTAMP | Creation timestamp |
| updated_at | TIMESTAMP | Update timestamp |
| is_system_generated | BOOLEAN | Whether generated by system |
| attachment_path | VARCHAR(255) | Path to attachment |
| attachment_type | VARCHAR(50) | Type of attachment |
| is_unsent | BOOLEAN | Whether notification is unsent |

### Notification Recipients Table

| Column | Type | Description |
|--------|------|-------------|
| id | BIGINT | Primary key |
| notification_id | BIGINT | Foreign key to notification |
| recipient_id | BIGINT | Foreign key to user |
| recipient_type | VARCHAR(50) | Type of recipient |
| class_id | BIGINT | Foreign key to class (if applicable) |
| is_read | BOOLEAN | Whether notification is read |
| read_at | TIMESTAMP | When notification was read |

## Usage Examples

### Sending a Simple Notification

```javascript
import notificationService from '../services/notificationService';

// Send a notification to a specific user
const sendNotification = async () => {
  try {
    const response = await notificationService.createNotification({
  title: 'Assignment Due',
      content: 'Your assignment is due tomorrow!',
      senderId: 1, // ID of the sender
      recipientType: 'INDIVIDUAL',
      recipientIds: [5], // ID of the recipient
      sendEmail: false
    });
    console.log('Notification sent:', response);
  } catch (error) {
    console.error('Error sending notification:', error);
  }
};
```

### Sending a Class Notification with Attachment

```javascript
import notificationService from '../services/notificationService';

// Send a notification to a class with attachment
const sendClassNotification = async (file) => {
  try {
    const formData = new FormData();
    formData.append('title', 'Class Materials');
    formData.append('content', '# New Materials\nPlease review the attached document.');
    formData.append('senderId', 1);
    formData.append('recipientType', 'CLASS');
    formData.append('recipientIds', 3); // Class ID
    formData.append('attachment', file);
    
    const response = await notificationService.createNotificationWithAttachment(formData);
    console.log('Class notification sent:', response);
  } catch (error) {
    console.error('Error sending class notification:', error);
  }
};
```

## Best Practices

1. **Notification Content**:
   - Keep titles concise and descriptive
   - Structure content clearly using markdown
   - Use formatting to emphasize important information

2. **File Attachments**:
   - Keep file sizes reasonable
   - Use appropriate file formats
   - Consider image dimensions for mobile devices

3. **Recipient Selection**:
   - Be specific with recipient targeting
   - Avoid sending to "All" unless necessary
   - Consider class-level notifications over individual ones for class-wide information

4. **Notification Management**:
   - Delete old notifications regularly
   - Unsend notifications that contain errors
   - Use system-generated notifications for automated events

## Troubleshooting

### Common Issues

1. **Notifications not showing up**:
   - Check recipient settings
   - Verify user permissions
   - Check for network issues

2. **Attachments not displaying**:
   - Verify file path is correct
   - Check file permissions
   - Ensure file type is supported

3. **Markdown not rendering**:
   - Verify markdown syntax is correct
   - Check for special characters that need escaping
   - Ensure markdown parser is functioning

### Debugging Tools

Use the `NotificationDebugger` component to:
- Test API connectivity
- View available test data
- Send test notifications
- Check system status 